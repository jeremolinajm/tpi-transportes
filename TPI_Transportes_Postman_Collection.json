{
	"info": {
		"_postman_id": "tpi-transportes-2025",
		"name": "TPI Transportes - Caminito Feliz",
		"description": "Colección completa para demostrar el flujo de trabajo del sistema de transportes",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "keycloak_url",
			"value": "http://localhost:8180",
			"type": "string"
		},
		{
			"key": "operador_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "cliente_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "transportista_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "solicitud_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "cliente_email",
			"value": "",
			"type": "string"
		},
		{
			"key": "transportista_email",
			"value": "",
			"type": "string"
		},
		{
			"key": "transportista_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "camion_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "tramo_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "ruta_id",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. OPERADOR - Autenticación y Tarifas",
			"item": [
				{
					"name": "1.1 Login Operador",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login exitoso\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.access_token).to.exist;",
									"    pm.collectionVariables.set(\"operador_token\", jsonData.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "username",
									"value": "operador.demo@mail.com",
									"type": "text"
								},
								{
									"key": "password",
									"value": "Demo123!",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "public-app",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/transportes-realm/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"transportes-realm",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.2 Crear Tarifa Base",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Tarifa base creada\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Tarifa Base 2025\",\n  \"descripcion\": \"Tarifa base para gestión y tramos\",\n  \"costoFijoGestion\": 5000.00,\n  \"costoAdicionalPorTramo\": 1500.00,\n  \"fechaVigenciaDesde\": \"2025-01-01\",\n  \"fechaVigenciaHasta\": \"2025-12-31\",\n  \"activa\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tarifas/base",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tarifas",
								"base"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.3 Crear Tarifa Combustible",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Tarifa combustible creada\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"descripcion\": \"Tarifa combustible 2025\",\n  \"precioPorLitro\": 850.00,\n  \"fechaVigenciaDesde\": \"2025-01-01\",\n  \"fechaVigenciaHasta\": \"2025-12-31\",\n  \"activa\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tarifas/combustible",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tarifas",
								"combustible"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.4 Crear Tarifa Estadía",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Tarifa estadía creada\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"descripcion\": \"Tarifa estadía en depósito 2025\",\n  \"costoPorHora\": 500.00,\n  \"fechaVigenciaDesde\": \"2025-01-01\",\n  \"fechaVigenciaHasta\": \"2025-12-31\",\n  \"activa\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/tarifas/estadia",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tarifas",
								"estadia"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.5 Listar Tarifas Base",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tarifas/base",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tarifas",
								"base"
							]
						}
					},
					"response": []
				},
				{
					"name": "1.6 Obtener Tarifa Base Vigente",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tarifas/base/vigente",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tarifas",
								"base",
								"vigente"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "2. OPERADOR - Transportistas y Camiones",
			"item": [
				{
					"name": "2.1 Crear Transportista",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Transportista creado\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"transportista_id\", jsonData.id);",
									"    pm.collectionVariables.set(\"transportista_email\", jsonData.email);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Juan\",\n  \"apellido\": \"Transportista\",\n  \"dni\": \"30456789\",\n  \"telefono\": \"11-5555-6666\",\n  \"email\": \"juan.trans@demo.com\",\n  \"password\": \"Trans123!\",\n  \"licenciaConducir\": \"B1-30456789\",\n  \"activo\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/transportista",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"transportista"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.2 Crear Camión",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Camión creado\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"camion_id\", jsonData.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"dominio\": \"AB123CD\",\n  \"marca\": \"Scania\",\n  \"modelo\": \"R450\",\n  \"anio\": 2024,\n  \"capacidadPesoKg\": 30000,\n  \"capacidadVolumenM3\": 80,\n  \"consumoCombustibleKmLitro\": 0.35,\n  \"costoBasePorKm\": 250.00,\n  \"transportistaId\": \"{{transportista_id}}\",\n  \"estado\": \"DISPONIBLE\",\n  \"activo\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/camiones",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"camiones"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.3 Listar Camiones",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/camiones",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"camiones"
							]
						}
					},
					"response": []
				},
				{
					"name": "2.4 Obtener Camiones Disponibles",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/camiones/disponibles?pesoKg=20000&volumenM3=40",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"camiones",
								"disponibles"
							],
							"query": [
								{
									"key": "pesoKg",
									"value": "20000"
								},
								{
									"key": "volumenM3",
									"value": "40"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "3. OPERADOR - Depósitos",
			"item": [
				{
					"name": "3.1 Crear Depósito",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Depósito Demo\",\n  \"direccion\": \"Av. Demo 1234, CABA\",\n  \"latitud\": -34.6037,\n  \"longitud\": -58.3816,\n  \"capacidadMaxima\": 100,\n  \"activo\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/depositos",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"depositos"
							]
						}
					},
					"response": []
				},
				{
					"name": "3.2 Actualizar Depósito",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Depósito Demo Actualizado\",\n  \"direccion\": \"Av. Demo 1234, CABA\",\n  \"latitud\": -34.6037,\n  \"longitud\": -58.3816,\n  \"capacidadMaxima\": 150,\n  \"activo\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/depositos/1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"depositos",
								"1"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "4. CLIENTE - Solicitudes",
			"item": [
				{
					"name": "4.1 Crear Solicitud (sin autenticación)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Solicitud creada con estado BORRADOR\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.estado).to.eql(\"BORRADOR\");",
									"    pm.collectionVariables.set(\"solicitud_id\", jsonData.id);",
									"    pm.collectionVariables.set(\"cliente_email\", jsonData.cliente.email);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"María\",\n  \"apellido\": \"Cliente\",\n  \"email\": \"maria.cliente@demo.com\",\n  \"password\": \"Cliente123!\",\n  \"telefono\": \"11-9999-8888\",\n  \"direccion\": \"Calle Demo 123\",\n  \"contenedor\": {\n    \"pesoKg\": 18000,\n    \"volumenM3\": 35.5,\n    \"descripcion\": \"Contenedor de prueba\"\n  },\n  \"origen\": {\n    \"direccion\": \"Buenos Aires, Argentina\",\n    \"latitud\": -34.6037,\n    \"longitud\": -58.3816\n  },\n  \"destino\": {\n    \"direccion\": \"Rosario, Santa Fe, Argentina\",\n    \"latitud\": -32.9442,\n    \"longitud\": -60.6505\n  },\n  \"observaciones\": \"Solicitud de prueba para demostración\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/solicitudes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"solicitudes"
							]
						}
					},
					"response": []
				},
				{
					"name": "4.2 Login Cliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login cliente exitoso\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"cliente_token\", jsonData.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "username",
									"value": "{{cliente_email}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "Cliente123!",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "public-app",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/transportes-realm/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"transportes-realm",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "4.3 Consultar Mis Solicitudes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{cliente_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/solicitudes/mis-solicitudes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"solicitudes",
								"mis-solicitudes"
							]
						}
					},
					"response": []
				},
				{
					"name": "4.4 Consultar Estado/Seguimiento",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{cliente_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/solicitudes/{{solicitud_id}}/seguimiento",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"solicitudes",
								"{{solicitud_id}}",
								"seguimiento"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "5. OPERADOR - Gestión de Rutas",
			"item": [
				{
					"name": "5.1 Generar Rutas Alternativas",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/rutas/alternativas/{{solicitud_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"rutas",
								"alternativas",
								"{{solicitud_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "5.2 Asignar Ruta (índice 0 - directa)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Ruta asignada correctamente\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.exist;",
									"    pm.expect(jsonData.tramos).to.be.an('array');",
									"    pm.expect(jsonData.tramos[0].id).to.exist;",
									"    pm.collectionVariables.set(\"ruta_id\", jsonData.id);",
									"    pm.collectionVariables.set(\"tramo_id\", jsonData.tramos[0].id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/rutas/{{solicitud_id}}/asignar/0",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"rutas",
								"{{solicitud_id}}",
								"asignar",
								"0"
							]
						}
					},
					"response": []
				},
				{
					"name": "5.3 Asignar Camión a Tramo",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/tramos/{{tramo_id}}/asignar-camion?camionId={{camion_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"tramos",
								"{{tramo_id}}",
								"asignar-camion"
							],
							"query": [
								{
									"key": "camionId",
									"value": "{{camion_id}}"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "6. OPERADOR - Costos",
			"item": [
				{
					"name": "6.1 Obtener Costo Estimado",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/costos/solicitud/{{solicitud_id}}/estimado",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"costos",
								"solicitud",
								"{{solicitud_id}}",
								"estimado"
							]
						}
					},
					"response": []
				},
				{
					"name": "6.2 Calcular Costo Final",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{operador_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/costos/solicitud/{{solicitud_id}}/final",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"costos",
								"solicitud",
								"{{solicitud_id}}",
								"final"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "7. TRANSPORTISTA - Gestión de Viajes",
			"item": [
				{
					"name": "7.1 Login Transportista",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login transportista exitoso\", function () {",
									"    pm.response.to.have.status(200);",
									"    var jsonData = pm.response.json();",
									"    pm.collectionVariables.set(\"transportista_token\", jsonData.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "username",
									"value": "{{transportista_email}}",
									"type": "text"
								},
								{
									"key": "password",
									"value": "Trans123!",
									"type": "text"
								},
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "public-app",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/transportes-realm/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"transportes-realm",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "7.2 Ver Tramos Asignados",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{transportista_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/transportista/tramos-asignados",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"transportista",
								"tramos-asignados"
							]
						}
					},
					"response": []
				},
				{
					"name": "7.3 Iniciar Tramo",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{transportista_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/transportista/tramos/{{tramo_id}}/iniciar",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"transportista",
								"tramos",
								"{{tramo_id}}",
								"iniciar"
							]
						}
					},
					"response": []
				},
				{
					"name": "7.4 Finalizar Tramo",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{transportista_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/transportista/tramos/{{tramo_id}}/finalizar",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"transportista",
								"tramos",
								"{{tramo_id}}",
								"finalizar"
							]
						}
					},
					"response": []
				}
			]
		}
	]
}
